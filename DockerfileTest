FROM python:3.7.4

RUN apt-get update && apt-get install -y build-essential

ADD requirements.txt /requirements.txt

RUN python -m venv /venv \
    && /venv/bin/pip install -U pip \
    && LIBRARY_PATH=/lib:/usr/lib /bin/sh -c "/venv/bin/pip install --no-cache-dir -r /requirements.txt"

RUN touch /venv/bin/activate
RUN /venv/bin/python3 -m nltk.downloader stopwords

WORKDIR /backend/

COPY . .
ENV BOOST_MODEL_FOLDER="/backend/model/0.2"

CMD ["make", "test-all"]